tinymce.ui.FloatPanel.zIndex=100100,tinymce.PluginManager.add("wordpress",function(e){function t(t){var n,o,d,i=0;o="hide"===t,e.theme.panel&&(d=e.theme.panel.find(".toolbar:not(.menubar)")),!d||d.length<2||"hide"===t&&!d[1].visible()||(!t&&d[1].visible()&&(t="hide"),tinymce.each(d,function(e,n){n>0&&("hide"===t?(e.hide(),i+=30):(e.show(),i-=30))}),i&&!o&&(tinymce.Env.iOS||(n=e.getContentAreaContainer().firstChild,m.setStyle(n,"height",n.clientHeight+i)),"hide"===t?(setUserSetting("hidetb","0"),a&&a.active(!1)):(setUserSetting("hidetb","1"),a&&a.active(!0))),e.fire("wp-toolbar-toggle"))}function n(e){return e.replace(/\[embed\]([\s\S]+?)\[\/embed\][\s\u00a0]*/g,function(e,t){return'<img width="300" height="200" src="'+tinymce.Env.transparentSrc+'" class="wp-oembed" alt="'+t+'" title="'+t+'" data-mce-resize="false" data-mce-placeholder="1" />'})}function o(e){return e.replace(/<img[^>]+>/g,function(e){if(-1!==e.indexOf('class="wp-oembed')){var t=e.match(/alt="([^\"]+)"/);t[1]&&(e="[embed]"+t[1]+"[/embed]")}return e})}function d(t,n){var o,d,i,a,r;i=e.dom.getViewPort(e.getWin()),o=m.getPos(e.getContentAreaContainer()),d=e.dom.getPos(t),a=Math.max(d.x-i.x,0)+o.x,r=Math.max(d.y-i.y,0)+o.y,m.setStyles(n,{top:r+5+"px",left:a+5+"px",display:"block"})}function i(){m.hide(m.select("#wp_editbtns, #wp_gallerybtns"))}var a,r,c,m=tinymce.DOM,s=0;return e.addButton("wp_adv",{tooltip:"Toolbar Toggle",cmd:"WP_Adv",onPostRender:function(){a=this,a.active("1"===getUserSetting("hidetb")?!0:!1)}}),e.on("PostRender",function(){e.getParam("wordpress_adv_hidden",!0)&&"0"===getUserSetting("hidetb","0")&&t("hide")}),e.addCommand("WP_Adv",function(){t()}),e.on("focus",function(){window.wpActiveEditor=e.id}),e.on("BeforeSetContent",function(t){var n;t.content&&(-1!==t.content.indexOf("<!--more")&&(n=e.editorManager.i18n.translate("Read more..."),t.content=t.content.replace(/<!--more(.*?)-->/g,function(e,t){return'<img src="'+tinymce.Env.transparentSrc+'" data-wp-more="more" data-wp-more-text="'+t+'" class="wp-more-tag mce-wp-more" title="'+n+'" data-mce-resize="false" data-mce-placeholder="1" />'})),-1!==t.content.indexOf("<!--nextpage-->")&&(n=e.editorManager.i18n.translate("Page break"),t.content=t.content.replace(/<!--nextpage-->/g,'<img src="'+tinymce.Env.transparentSrc+'" data-wp-more="nextpage" class="wp-more-tag mce-wp-nextpage" title="'+n+'" data-mce-resize="false" data-mce-placeholder="1" />')))}),e.on("PostProcess",function(e){e.get&&(e.content=e.content.replace(/<img[^>]+>/g,function(e){var t,n="";return-1!==e.indexOf('data-wp-more="more"')?((t=e.match(/data-wp-more-text="([^"]+)"/))&&(n=t[1]),e="<!--more"+n+"-->"):-1!==e.indexOf('data-wp-more="nextpage"')&&(e="<!--nextpage-->"),e}))}),e.on("ResolveName",function(t){var n;"IMG"===t.target.nodeName&&(n=e.dom.getAttrib(t.target,"data-wp-more"))&&(t.name=n)}),e.addCommand("WP_More",function(t){var n,o,d,i="wp-more-tag",a=e.dom,r=e.selection.getNode();return t=t||"more",i+=" mce-wp-"+t,d="more"===t?"Read more...":"Next page",d=e.editorManager.i18n.translate(d),o='<img src="'+tinymce.Env.transparentSrc+'" title="'+d+'" class="'+i+'" data-wp-more="'+t+'" data-mce-resize="false" data-mce-placeholder="1" />',"BODY"===r.nodeName||"P"===r.nodeName&&"BODY"===r.parentNode.nodeName?(e.insertContent(o),void 0):(n=a.getParent(r,function(e){return e.parentNode&&"BODY"===e.parentNode.nodeName?!0:!1},e.getBody()),n&&("P"===n.nodeName?n.appendChild(a.create("p",null,o).firstChild):a.insertAfter(a.create("p",null,o),n),e.nodeChanged()),void 0)}),e.addCommand("WP_Code",function(){e.formatter.toggle("code")}),e.addCommand("WP_Page",function(){e.execCommand("WP_More","nextpage")}),e.addCommand("WP_Help",function(){e.windowManager.open({url:tinymce.baseURL+"/wp-mce-help.php",title:"Keyboard Shortcuts",width:450,height:420,inline:1,classes:"wp-help"})}),e.addCommand("WP_Medialib",function(){"undefined"!=typeof wp&&wp.media&&wp.media.editor&&wp.media.editor.open(e.id)}),e.addButton("wp_more",{tooltip:"Insert Read More tag",onclick:function(){e.execCommand("WP_More","more")}}),e.addButton("wp_page",{tooltip:"Page break",onclick:function(){e.execCommand("WP_More","nextpage")}}),e.addButton("wp_help",{tooltip:"Keyboard Shortcuts",cmd:"WP_Help"}),e.addButton("wp_code",{tooltip:"Code",cmd:"WP_Code",stateSelector:"code"}),"undefined"!=typeof wp&&wp.media&&wp.media.editor&&e.addMenuItem("add_media",{text:"Add Media",icon:"wp-media-library",context:"insert",cmd:"WP_Medialib"}),e.addMenuItem("wp_more",{text:"Insert Read More tag",icon:"wp_more",context:"insert",onclick:function(){e.execCommand("WP_More","more")}}),e.addMenuItem("wp_page",{text:"Page break",icon:"wp_page",context:"insert",onclick:function(){e.execCommand("WP_More","nextpage")}}),e.on("BeforeExecCommand",function(t){!tinymce.Env.webkit||"InsertUnorderedList"!==t.command&&"InsertOrderedList"!==t.command||(c||(c=e.dom.create("style",{type:"text/css"},"#tinymce,#tinymce span,#tinymce li,#tinymce li>span,#tinymce p,#tinymce p>span{font:medium sans-serif;color:#000;line-height:normal;}")),e.getDoc().head.appendChild(c))}),e.on("ExecCommand",function(t){tinymce.Env.webkit&&c&&("InsertUnorderedList"===t.command||"InsertOrderedList"===t.command)&&e.dom.remove(c)}),e.on("init",function(){var t=tinymce.Env,n=["mceContentBody"],o=e.getDoc(),d=e.dom;tinymce.Env.iOS&&d.addClass(o.documentElement,"ios"),"rtl"===e.getParam("directionality")&&(n.push("rtl"),d.setAttrib(o.documentElement,"dir","rtl")),t.ie?9===parseInt(t.ie,10)?n.push("ie9"):8===parseInt(t.ie,10)?n.push("ie8"):t.ie<8&&n.push("ie7"):t.webkit&&n.push("webkit"),n.push("wp-editor"),tinymce.each(n,function(e){e&&d.addClass(o.body,e)}),e.on("BeforeSetContent",function(e){e.content&&(e.content=e.content.replace(/<p>\s*<(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre|address)( [^>]*)?>/gi,"<$1$2>"),e.content=e.content.replace(/<\/(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre|address)>\s*<\/p>/gi,"</$1>"))}),"undefined"!=typeof window.jQuery&&window.jQuery(document).triggerHandler("tinymce-editor-init",[e]),window.tinyMCEPreInit&&window.tinyMCEPreInit.dragDropUpload&&d.bind(o,"dragstart dragend dragover drop",function(e){"undefined"!=typeof window.jQuery&&window.jQuery(document).trigger(new window.jQuery.Event(e))}),e.getParam("wp_paste_filters",!0)&&(tinymce.Env.webkit||e.on("PastePreProcess",function(e){e.content=e.content.replace(/(<[^>]+) style="[^"]*"([^>]*>)/gi,"$1$2"),e.content=e.content.replace(/(<[^>]+) data-mce-style=([^>]+>)/gi,"$1 style=$2")}),e.on("PastePostProcess",function(e){tinymce.each(d.select("p",e.node),function(e){d.isEmpty(e)&&d.remove(e)})}))}),"undefined"!=typeof window.jQuery&&e.on("keyup",function(t){var n=t.keyCode||t.charCode;n!==s&&((13===n||8===s||46===s)&&window.jQuery(document).triggerHandler("wpcountwords",[e.getContent({format:"raw"})]),s=n)}),e.on("SaveContent",function(t){return!e.inline&&e.isHidden()?(t.content=t.element.value,void 0):(t.content=t.content.replace(/<p>(?:<br ?\/?>|\u00a0|\uFEFF| )*<\/p>/g,"<p>&nbsp;</p>"),e.getParam("wpautop",!0)&&"undefined"!=typeof window.switchEditors&&(t.content=window.switchEditors.pre_wpautop(t.content)),void 0)}),e.on("BeforeSetContent",function(e){e.content&&(e.content=e.content.replace(/<p>(?:&nbsp;|\u00a0|\uFEFF| )+<\/p>/gi,"<p></p>"))}),e.on("preInit",function(){e.schema.addValidElements("@[id|accesskey|class|dir|lang|style|tabindex|title|contenteditable|draggable|dropzone|hidden|spellcheck|translate],i,b"),tinymce.Env.iOS&&(e.settings.height=300)}),r="alt+shift",e.addShortcut(r+"+c","","JustifyCenter"),e.addShortcut(r+"+r","","JustifyRight"),e.addShortcut(r+"+l","","JustifyLeft"),e.addShortcut(r+"+j","","JustifyFull"),e.addShortcut(r+"+q","","mceBlockQuote"),e.addShortcut(r+"+u","","InsertUnorderedList"),e.addShortcut(r+"+o","","InsertOrderedList"),e.addShortcut(r+"+n","","mceSpellCheck"),e.addShortcut(r+"+s","","unlink"),e.addShortcut(r+"+m","","WP_Medialib"),e.addShortcut(r+"+z","","WP_Adv"),e.addShortcut(r+"+t","","WP_More"),e.addShortcut(r+"+d","","Strikethrough"),e.addShortcut(r+"+h","","WP_Help"),e.addShortcut(r+"+p","","WP_Page"),e.addShortcut(r+"+x","","WP_Code"),e.addShortcut("ctrl+s","",function(){"undefined"!=typeof wp&&wp.autosave&&wp.autosave.server.triggerSave()}),e.on("init",function(){e.dom.bind(e.getWin(),"scroll",function(){i()}),e.dom.bind(e.getBody(),"dragstart",function(){i()})}),e.on("BeforeExecCommand",function(){i()}),e.on("SaveContent",function(){i()}),e.on("MouseDown",function(e){"IMG"!==e.target.nodeName&&i()}),e.on("keydown",function(e){(e.which===tinymce.util.VK.DELETE||e.which===tinymce.util.VK.BACKSPACE)&&i()}),{_showButtons:d,_hideButtons:i,_setEmbed:n,_getEmbed:o}});