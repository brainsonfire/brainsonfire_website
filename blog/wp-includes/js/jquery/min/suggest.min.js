!function(e){e.suggest=function(t,l){function s(){var e=f.offset();m.css({top:e.top+t.offsetHeight+"px",left:e.left+"px"})}function a(e){if(/27$|38$|40$/.test(e.keyCode)&&m.is(":visible")||/^13$|^9$/.test(e.keyCode)&&o())switch(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,e.returnValue=!1,e.keyCode){case 38:d();break;case 40:p();break;case 9:case 13:h();break;case 27:m.hide()}else f.val().length!=v&&(C&&clearTimeout(C),C=setTimeout(i,l.delay),v=f.val().length)}function i(){var t,s,a=e.trim(f.val());l.multiple&&(t=a.lastIndexOf(l.multipleSep),-1!=t&&(a=e.trim(a.substr(t+l.multipleSep.length)))),a.length>=l.minchars?(cached=n(a),cached?c(cached.items):e.get(l.source,{q:a},function(e){m.hide(),s=u(e,a),c(s),r(a,s,e.length)})):m.hide()}function n(e){var t;for(t=0;t<g.length;t++)if(g[t].q==e)return g.unshift(g.splice(t,1)[0]),g[0];return!1}function r(e,t,s){for(var a;g.length&&S+s>l.maxCacheSize;)a=g.pop(),S-=a.size;g.push({q:e,size:s,items:t}),S+=s}function c(t){var a,i="";if(t){if(!t.length)return m.hide(),void 0;for(s(),a=0;a<t.length;a++)i+="<li>"+t[a]+"</li>";m.html(i).show(),m.children("li").mouseover(function(){m.children("li").removeClass(l.selectClass),e(this).addClass(l.selectClass)}).click(function(e){e.preventDefault(),e.stopPropagation(),h()})}}function u(t,s){var a,i,n=[],r=t.split(l.delimiter);for(a=0;a<r.length;a++)i=e.trim(r[a]),i&&(i=i.replace(new RegExp(s,"ig"),function(e){return'<span class="'+l.matchClass+'">'+e+"</span>"}),n[n.length]=i);return n}function o(){var e;return m.is(":visible")?(e=m.children("li."+l.selectClass),e.length||(e=!1),e):!1}function h(){$currentResult=o(),$currentResult&&(l.multiple?($currentVal=-1!=f.val().indexOf(l.multipleSep)?f.val().substr(0,f.val().lastIndexOf(l.multipleSep)+l.multipleSep.length)+" ":"",f.val($currentVal+$currentResult.text()+l.multipleSep+" "),f.focus()):f.val($currentResult.text()),m.hide(),f.trigger("change"),l.onSelect&&l.onSelect.apply(f[0]))}function p(){$currentResult=o(),$currentResult?$currentResult.removeClass(l.selectClass).next().addClass(l.selectClass):m.children("li:first-child").addClass(l.selectClass)}function d(){var e=o();e?e.removeClass(l.selectClass).prev().addClass(l.selectClass):m.children("li:last-child").addClass(l.selectClass)}var f,m,C,v,g,S;f=e(t).attr("autocomplete","off"),m=e("<ul/>"),C=!1,v=0,g=[],S=0,m.addClass(l.resultsClass).appendTo("body"),s(),e(window).load(s).resize(s),f.blur(function(){setTimeout(function(){m.hide()},200)}),f.keydown(a)},e.fn.suggest=function(t,l){return t?(l=l||{},l.multiple=l.multiple||!1,l.multipleSep=l.multipleSep||",",l.source=t,l.delay=l.delay||100,l.resultsClass=l.resultsClass||"ac_results",l.selectClass=l.selectClass||"ac_over",l.matchClass=l.matchClass||"ac_match",l.minchars=l.minchars||2,l.delimiter=l.delimiter||"\n",l.onSelect=l.onSelect||!1,l.maxCacheSize=l.maxCacheSize||65536,this.each(function(){new e.suggest(this,l)}),this):void 0}}(jQuery);