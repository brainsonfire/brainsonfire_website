!function(e,t){function i(e){var t,i={number:null,id_base:null};return t=e.match(/^(.+)-(\d+)$/),t?(i.id_base=t[1],i.number=parseInt(t[2],10)):i.id_base=e,i}function n(e){var t,n=i(e);return t="widget_"+n.id_base,n.number&&(t+="["+n.number+"]"),t}if(e&&e.customize){var s,d=e.customize;d.Widgets=d.Widgets||{},d.Widgets.data=_wpCustomizeWidgetsSettings||{},s=d.Widgets.data.l10n,delete d.Widgets.data.l10n,d.Widgets.WidgetModel=Backbone.Model.extend({id:null,temp_id:null,classname:null,control_tpl:null,description:null,is_disabled:null,is_multi:null,multi_number:null,name:null,id_base:null,transport:"refresh",params:[],width:null,height:null,search_matched:!0}),d.Widgets.WidgetCollection=Backbone.Collection.extend({model:d.Widgets.WidgetModel,doSearch:function(e){this.terms!==e&&(this.terms=e,this.terms.length>0&&this.search(this.terms),""===this.terms&&this.each(function(e){e.set("search_matched",!0)}))},search:function(e){var t,i;e=e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),e=e.replace(/ /g,")(?=.*"),t=new RegExp("^(?=.*"+e+").+","i"),this.each(function(e){i=[e.get("name"),e.get("id"),e.get("description")].join(" "),e.set("search_matched",t.test(i))})}}),d.Widgets.availableWidgets=new d.Widgets.WidgetCollection(d.Widgets.data.availableWidgets),d.Widgets.SidebarModel=Backbone.Model.extend({after_title:null,after_widget:null,before_title:null,before_widget:null,"class":null,description:null,id:null,name:null,is_rendered:!1}),d.Widgets.SidebarCollection=Backbone.Collection.extend({model:d.Widgets.SidebarModel}),d.Widgets.registeredSidebars=new d.Widgets.SidebarCollection(d.Widgets.data.registeredSidebars),d.Widgets.AvailableWidgetsPanelView=e.Backbone.View.extend({el:"#available-widgets",events:{"input #widgets-search":"search","keyup #widgets-search":"search","change #widgets-search":"search","search #widgets-search":"search","focus .widget-tpl":"focus","click .widget-tpl":"_submit","keypress .widget-tpl":"_submit",keydown:"keyboardAccessible"},selected:null,currentSidebarControl:null,$search:null,initialize:function(){var e=this;this.$search=t("#widgets-search"),_.bindAll(this,"close"),this.listenTo(this.collection,"change",this.updateList),this.updateList(),t("#customize-controls").on("click keydown",function(i){var n=t(i.target).is(".add-new-widget, .add-new-widget *");t("body").hasClass("adding-widget")&&!n&&e.close()}),d.previewer.bind("url",this.close)},search:function(e){var t;this.collection.doSearch(e.target.value),this.selected&&!this.selected.is(":visible")&&(this.selected.removeClass("selected"),this.selected=null),this.selected&&!e.target.value&&(this.selected.removeClass("selected"),this.selected=null),!this.selected&&e.target.value&&(t=this.$el.find("> .widget-tpl:visible:first"),t.length&&this.select(t))},updateList:function(){this.collection.each(function(e){var i=t("#widget-tpl-"+e.id);i.toggle(e.get("search_matched")&&!e.get("is_disabled")),e.get("is_disabled")&&i.is(this.selected)&&(this.selected=null)})},select:function(e){this.selected=t(e),this.selected.siblings(".widget-tpl").removeClass("selected"),this.selected.addClass("selected")},focus:function(e){this.select(t(e.currentTarget))},_submit:function(e){("keypress"!==e.type||13===e.which||32===e.which)&&this.submit(t(e.currentTarget))},submit:function(e){var i,n;e||(e=this.selected),e&&this.currentSidebarControl&&(this.select(e),i=t(this.selected).data("widget-id"),n=this.collection.findWhere({id:i}),n&&(this.currentSidebarControl.addWidget(n.get("id_base")),this.close()))},open:function(e){this.currentSidebarControl=e,_(this.currentSidebarControl.getWidgetFormControls()).each(function(e){e.params.is_wide&&e.collapseForm()}),t("body").addClass("adding-widget"),this.$el.find(".selected").removeClass("selected"),this.collection.doSearch(""),this.$search.focus()},close:function(e){e=e||{},e.returnFocus&&this.currentSidebarControl&&this.currentSidebarControl.container.find(".add-new-widget").focus(),this.currentSidebarControl=null,this.selected=null,t("body").removeClass("adding-widget"),this.$search.val("")},keyboardAccessible:function(e){var i=13===e.which,n=27===e.which,s=40===e.which,d=38===e.which,o=9===e.which,a=e.shiftKey,r=null,c=this.$el.find("> .widget-tpl:visible:first"),l=this.$el.find("> .widget-tpl:visible:last"),g=t(e.target).is(this.$search),h=t(e.target).is(".widget-tpl:visible:last");return s||d?(s?g?r=c:this.selected&&0!==this.selected.nextAll(".widget-tpl:visible").length&&(r=this.selected.nextAll(".widget-tpl:visible:first")):d&&(g?r=l:this.selected&&0!==this.selected.prevAll(".widget-tpl:visible").length&&(r=this.selected.prevAll(".widget-tpl:visible:first"))),this.select(r),r?r.focus():this.$search.focus(),void 0):((!i||this.$search.val())&&(i?this.submit():n&&this.close({returnFocus:!0}),o&&(a&&g||!a&&h)&&(this.currentSidebarControl.container.find(".add-new-widget").focus(),e.preventDefault())),void 0)}}),d.Widgets.formSyncHandlers={rss:function(e,i,n){var s=i.find(".widget-error:first"),d=t("<div>"+n+"</div>").find(".widget-error:first");s.length&&d.length?s.replaceWith(d):s.length?s.remove():d.length&&i.find(".widget-content:first").prepend(d)}},d.Widgets.WidgetControl=d.Control.extend({ready:function(){this._setupModel(),this._setupWideWidget(),this._setupControlToggle(),this._setupWidgetTitle(),this._setupReorderUI(),this._setupHighlightEffects(),this._setupUpdateUI(),this._setupRemoveUI()},_setupModel:function(){var e,t=this;d.Widgets.savedWidgetIds=d.Widgets.savedWidgetIds||[],e=function(){d.Widgets.savedWidgetIds[t.params.widget_id]=!0},d.bind("ready",e),d.bind("saved",e),this._updateCount=0,this.isWidgetUpdating=!1,this.liveUpdateMode=!0,this.setting.bind(function(e,i){_(i).isEqual(e)||t.isWidgetUpdating||t.updateWidget({instance:e})})},_setupWideWidget:function(){var e,i,n,s,o,a=this;this.params.is_wide&&(e=this.container.find(".widget-inside"),i=e.find("> .form"),n=t(".wp-full-overlay-sidebar-content:first"),this.container.addClass("wide-widget-control"),this.container.find(".widget-content:first").css({"max-width":this.params.width,"min-height":this.params.height}),o=function(){var n,s=a.container.offset().top,d=t(window).height(),o=i.outerHeight();e.css("max-height",d),n=Math.max(0,Math.min(Math.max(s,0),d-o)),e.css("top",n)},s=t("#customize-theme-controls"),this.container.on("expand",function(){o(),n.on("scroll",o),t(window).on("resize",o),s.on("expanded collapsed",o)}),this.container.on("collapsed",function(){n.off("scroll",o),t(window).off("resize",o),s.off("expanded collapsed",o)}),d.each(function(e){0===e.id.indexOf("sidebars_widgets[")&&e.bind(function(){a.container.hasClass("expanded")&&o()})}))},_setupControlToggle:function(){var e,t=this;this.container.find(".widget-top").on("click",function(e){e.preventDefault();var i=t.getSidebarWidgetsControl();i.isReordering||t.toggleForm()}),e=this.container.find(".widget-control-close"),e.on("click",function(e){e.preventDefault(),t.collapseForm(),t.container.find(".widget-top .widget-action:first").focus()})},_setupWidgetTitle:function(){var e,t=this;e=function(){var e=t.setting().title,i=t.container.find(".in-widget-title");e?i.text(": "+e):i.text("")},this.setting.bind(e),e()},_setupReorderUI:function(){var e,i,n,s,o=this;e=function(e){e.siblings(".selected").removeClass("selected"),e.addClass("selected");var t=e.data("id")===o.params.sidebar_id;o.container.find(".move-widget-btn").prop("disabled",t)},this.container.find(".widget-title-action").after(t(d.Widgets.data.tpl.widgetReorderNav)),i=t(_.template(d.Widgets.data.tpl.moveWidgetArea,{sidebars:_(d.Widgets.registeredSidebars.toArray()).pluck("attributes")})),this.container.find(".widget-top").after(i),s=function(){var n,s=i.find("li");n=s.filter(function(){return t(this).data("id")===o.params.sidebar_id}),s.each(function(){var i,s,o=t(this);i=o.data("id"),s=d.Widgets.registeredSidebars.get(i),o.toggle(s.get("is_rendered")),o.hasClass("selected")&&!s.get("is_rendered")&&e(n)})},s(),d.Widgets.registeredSidebars.on("change:is_rendered",s),n=this.container.find(".widget-reorder-nav"),n.find(".move-widget, .move-widget-down, .move-widget-up").each(function(){t(this).prepend(o.container.find(".widget-title").text()+": ")}).on("click keypress",function(e){if("keypress"!==e.type||13===e.which||32===e.which)if(t(this).focus(),t(this).is(".move-widget"))o.toggleWidgetMoveArea();else{var i=t(this).is(".move-widget-down"),n=t(this).is(".move-widget-up"),s=o.getWidgetSidebarPosition();if(n&&0===s||i&&s===o.getSidebarWidgetsControl().setting().length-1)return;n?o.moveUp():o.moveDown(),t(this).focus()}}),this.container.find(".widget-area-select").on("click keypress","li",function(i){("keypress"!==event.type||13===event.which||32===event.which)&&(i.preventDefault(),e(t(this)))}),this.container.find(".move-widget-btn").click(function(){o.getSidebarWidgetsControl().toggleReordering(!1);var e,t,i,n,s,a=o.params.sidebar_id,r=o.container.find(".widget-area-select li.selected").data("id");e=d("sidebars_widgets["+a+"]"),t=d("sidebars_widgets["+r+"]"),i=Array.prototype.slice.call(e()),n=Array.prototype.slice.call(t()),s=o.getWidgetSidebarPosition(),i.splice(s,1),n.push(o.params.widget_id),e(i),t(n),o.focus()})},_setupHighlightEffects:function(){var e=this;this.container.on("mouseenter click",function(){e.setting.previewer.send("highlight-widget",e.params.widget_id)}),this.setting.bind(function(){e.setting.previewer.send("highlight-widget",e.params.widget_id)})},_setupUpdateUI:function(){var e,i,n,o,a,r=this;e=this.container.find(".widget:first"),i=e.find(".widget-content:first"),n=this.container.find(".widget-control-save"),n.val(s.saveBtnLabel),n.attr("title",s.saveBtnTooltip),n.removeClass("button-primary").addClass("button-secondary"),n.on("click",function(e){e.preventDefault(),r.updateWidget({disable_form:!0})}),o=_.debounce(function(){r.updateWidget()},250),i.on("keydown","input",function(e){13===e.which&&(e.preventDefault(),r.updateWidget({ignoreActiveElement:!0}))}),i.on("change input propertychange",":input",function(e){r.liveUpdateMode&&("change"===e.type?r.updateWidget():this.checkValidity&&this.checkValidity()&&o())}),this.setting.previewer.channel.bind("synced",function(){r.container.removeClass("previewer-loading")}),d.previewer.bind("widget-updated",function(e){e===r.params.widget_id&&r.container.removeClass("previewer-loading")}),a=d.Widgets.formSyncHandlers[this.params.widget_id_base],a&&t(document).on("widget-synced",function(t,i){e.is(i)&&a.apply(document,arguments)})},toggle:function(e){this.container.toggleClass("widget-rendered",e)},_setupRemoveUI:function(){var e,t,i=this;e=this.container.find("a.widget-control-remove"),e.on("click",function(e){e.preventDefault();var t;t=i.container.next().is(".customize-control-widget_form")?i.container.next().find(".widget-action:first"):i.container.prev().is(".customize-control-widget_form")?i.container.prev().find(".widget-action:first"):i.container.next(".customize-control-sidebar_widgets").find(".add-new-widget:first"),i.container.slideUp(function(){var e,n,s=d.Widgets.getSidebarWidgetControlContainingWidget(i.params.widget_id);s&&(e=s.setting().slice(),n=_.indexOf(e,i.params.widget_id),-1!==n&&(e.splice(n,1),s.setting(e),t.focus()))})}),t=function(){e.text(s.removeBtnLabel),e.attr("title",s.removeBtnTooltip)},this.params.is_new?d.bind("saved",t):t()},_getInputs:function(e){return t(e).find(":input[name]")},_getInputsSignature:function(e){var i=_(e).map(function(e){var i,n=t(e);return i=n.is(":checkbox, :radio")?[n.attr("id"),n.attr("name"),n.prop("value")]:[n.attr("id"),n.attr("name")],i.join(",")});return i.join(";")},_getInputStatePropertyName:function(e){var i=t(e);return i.is(":radio, :checkbox")?"checked":"value"},getSidebarWidgetsControl:function(){var e,t;return e="sidebars_widgets["+this.params.sidebar_id+"]",(t=d.control(e))?t:void 0},updateWidget:function(i){var n,o,a,r,c,l,g,h,u,f,p,m=this;i=t.extend({instance:null,complete:null,ignoreActiveElement:!1},i),n=i.instance,o=i.complete,this._updateCount+=1,c=this._updateCount,a=this.container.find(".widget:first"),r=a.find(".widget-content:first"),r.find(".widget-error").remove(),this.container.addClass("widget-form-loading"),this.container.addClass("previewer-loading"),u=d.state("processing"),u(u()+1),this.liveUpdateMode||this.container.addClass("widget-form-disabled"),l={},l.action="update-widget",l.wp_customize="on",l.nonce=d.Widgets.data.nonce,l.theme=d.settings.theme.stylesheet,g=t.param(l),h=this._getInputs(r),h.each(function(){var e=t(this),i=m._getInputStatePropertyName(this);e.data("state"+c,e.prop(i))}),g+=n?"&"+t.param({sanitized_widget_setting:JSON.stringify(n)}):"&"+h.serialize(),g+="&"+r.find("~ :input").serialize(),f=t.post(e.ajax.settings.url,g),f.done(function(e){var n,l,g,u,f=!1;return"0"===e?(d.previewer.preview.iframe.hide(),d.previewer.login().done(function(){m.updateWidget(i),d.previewer.preview.iframe.show()}),void 0):"-1"===e?(d.previewer.cheatin(),void 0):(e.success?(l=t("<div>"+e.data.form+"</div>"),g=m._getInputs(l),u=m._getInputsSignature(h)===m._getInputsSignature(g),u&&!m.liveUpdateMode&&(m.liveUpdateMode=!0,m.container.removeClass("widget-form-disabled"),m.container.find('input[name="savewidget"]').hide()),u&&m.liveUpdateMode?(h.each(function(e){var n,s,d,o=t(this),a=t(g[e]),r=m._getInputStatePropertyName(this);n=o.data("state"+c),s=a.prop(r),o.data("sanitized",s),d=n!==s&&(i.ignoreActiveElement||!o.is(document.activeElement)),d&&o.prop(r,s)}),t(document).trigger("widget-synced",[a,e.data.form])):m.liveUpdateMode?(m.liveUpdateMode=!1,m.container.find('input[name="savewidget"]').show(),f=!0):(r.html(e.data.form),m.container.removeClass("widget-form-disabled"),t(document).trigger("widget-updated",[a])),p=!f&&!_(m.setting()).isEqual(e.data.instance),p?(m.isWidgetUpdating=!0,m.setting(e.data.instance),m.isWidgetUpdating=!1):m.container.removeClass("previewer-loading"),o&&o.call(m,null,{noChange:!p,ajaxFinished:!0})):(n=s.error,e.data&&e.data.message&&(n=e.data.message),o?o.call(m,n):r.prepend('<p class="widget-error"><strong>'+n+"</strong></p>")),void 0)}),f.fail(function(e,t){o&&o.call(m,t)}),f.always(function(){m.container.removeClass("widget-form-loading"),h.each(function(){t(this).removeData("state"+c)}),u(u()-1)})},expandControlSection:function(){var e=this.container.closest(".accordion-section");e.hasClass("open")||e.find(".accordion-section-title:first").trigger("click")},expandForm:function(){this.toggleForm(!0)},collapseForm:function(){this.toggleForm(!1)},toggleForm:function(e){var t,i,n,s=this;t=this.container.find("div.widget:first"),i=t.find(".widget-inside:first"),"undefined"==typeof e&&(e=!i.is(":visible")),i.is(":visible")!==e&&(e?(d.control.each(function(e){s.params.type===e.params.type&&s!==e&&e.collapseForm()}),n=function(){s.container.removeClass("expanding"),s.container.addClass("expanded"),s.container.trigger("expanded")},s.params.is_wide?i.fadeIn("fast",n):i.slideDown("fast",n),s.container.trigger("expand"),s.container.addClass("expanding")):(n=function(){s.container.removeClass("collapsing"),s.container.removeClass("expanded"),s.container.trigger("collapsed")},s.container.trigger("collapse"),s.container.addClass("collapsing"),s.params.is_wide?i.fadeOut("fast",n):i.slideUp("fast",function(){t.css({width:"",margin:""}),n()})))},focus:function(){this.expandControlSection(),this.expandForm(),this.container.find(".widget-content :focusable:first").focus()},getWidgetSidebarPosition:function(){var e,t;return e=this.getSidebarWidgetsControl().setting(),t=_.indexOf(e,this.params.widget_id),-1!==t?t:void 0},moveUp:function(){this._moveWidgetByOne(-1)},moveDown:function(){this._moveWidgetByOne(1)},_moveWidgetByOne:function(e){var t,i,n,s;t=this.getWidgetSidebarPosition(),i=this.getSidebarWidgetsControl().setting,n=Array.prototype.slice.call(i()),s=n[t+e],n[t+e]=this.params.widget_id,n[t]=s,i(n)},toggleWidgetMoveArea:function(e){var i,n=this;i=this.container.find(".move-widget-area"),"undefined"==typeof e&&(e=!i.hasClass("active")),e&&(i.find(".selected").removeClass("selected"),i.find("li").filter(function(){return t(this).data("id")===n.params.sidebar_id}).addClass("selected"),this.container.find(".move-widget-btn").prop("disabled",!0)),i.toggleClass("active",e)},highlightSectionAndControl:function(){var e;e=this.container.is(":hidden")?this.container.closest(".control-section"):this.container,t(".highlighted").removeClass("highlighted"),e.addClass("highlighted"),setTimeout(function(){e.removeClass("highlighted")},500)}}),d.Widgets.SidebarControl=d.Control.extend({ready:function(){this.$controlSection=this.container.closest(".control-section"),this.$sectionContent=this.container.closest(".accordion-section-content"),this._setupModel(),this._setupSortable(),this._setupAddition(),this._applyCardinalOrderClassNames()},_setupModel:function(){var e=this,n=d.Widgets.registeredSidebars.get(this.params.sidebar_id);this.setting.bind(function(n,s){var o,a,r,c;c=_(s).difference(n),n=_(n).filter(function(e){var t=i(e);return!!d.Widgets.availableWidgets.findWhere({id_base:t.id_base})}),o=_(n).map(function(t){var i=d.Widgets.getWidgetFormControlForWidget(t);return i||(i=e.addWidget(t)),i}),o.sort(function(e,t){var i=_.indexOf(n,e.params.widget_id),s=_.indexOf(n,t.params.widget_id);return i===s?0:s>i?-1:1}),r=_(o).map(function(e){return e.container[0]}),a=e.$sectionContent.find(".customize-control-sidebar_widgets"),a.before(r),e._applyCardinalOrderClassNames(),_(o).each(function(t){t.params.sidebar_id=e.params.sidebar_id}),_(c).each(function(n){setTimeout(function(){var s,o,a,r,c,l=!1;d.each(function(t){if(t.id!==e.setting.id&&0===t.id.indexOf("sidebars_widgets[")&&"sidebars_widgets[wp_inactive_widgets]"!==t.id){var i,s=t();i=_.indexOf(s,n),-1!==i&&(l=!0)}}),l||(s=d.Widgets.getWidgetFormControlForWidget(n),o=s&&t.contains(document,s.container[0])&&!t.contains(e.$sectionContent[0],s.container[0]),s&&!o&&(d.control.remove(s.id),s.container.remove()),d.Widgets.savedWidgetIds[n]&&(a=d.value("sidebars_widgets[wp_inactive_widgets]")().slice(),a.push(n),d.value("sidebars_widgets[wp_inactive_widgets]")(_(a).unique())),r=i(n).id_base,c=d.Widgets.availableWidgets.findWhere({id_base:r}),c&&!c.get("is_multi")&&c.set("is_disabled",!1))})})}),e.active.bind(function(e){n.set("is_rendered",e)})},toggle:function(e){var i,n;n="#accordion-section-sidebar-widgets-"+this.params.sidebar_id,i=t(n),e?i.stop().slideDown(function(){t(this).css("height","auto")}):(i.hasClass("open")&&i.find(".accordion-section-title").trigger("click"),i.stop().slideUp())},_setupSortable:function(){var e=this;this.isReordering=!1,this.$sectionContent.sortable({items:"> .customize-control-widget_form",handle:".widget-top",axis:"y",connectWith:".accordion-section-content:has(.customize-control-sidebar_widgets)",update:function(){var i,n=e.$sectionContent.sortable("toArray");i=t.map(n,function(e){return t("#"+e).find(":input[name=widget-id]").val()}),e.setting(i)}}),this.$controlSection.find(".accordion-section-title").droppable({accept:".customize-control-widget_form",over:function(){e.$controlSection.hasClass("open")||(e.$controlSection.addClass("open"),e.$sectionContent.toggle(!1).slideToggle(150,function(){e.$sectionContent.sortable("refreshPositions")}))}}),this.container.find(".reorder-toggle").on("click keydown",function(t){("keydown"!==t.type||13===t.which||32===t.which)&&e.toggleReordering(!e.isReordering)})},_setupAddition:function(){var e=this;this.container.find(".add-new-widget").on("click keydown",function(i){("keydown"!==i.type||13===i.which||32===i.which)&&(e.$sectionContent.hasClass("reordering")||(t("body").hasClass("adding-widget")?d.Widgets.availableWidgetsPanel.close():d.Widgets.availableWidgetsPanel.open(e)))})},_applyCardinalOrderClassNames:function(){this.$sectionContent.find(".customize-control-widget_form").removeClass("first-widget").removeClass("last-widget").find(".move-widget-down, .move-widget-up").prop("tabIndex",0),this.$sectionContent.find(".customize-control-widget_form:first").addClass("first-widget").find(".move-widget-up").prop("tabIndex",-1),this.$sectionContent.find(".customize-control-widget_form:last").addClass("last-widget").find(".move-widget-down").prop("tabIndex",-1)},toggleReordering:function(e){e=Boolean(e),e!==this.$sectionContent.hasClass("reordering")&&(this.isReordering=e,this.$sectionContent.toggleClass("reordering",e),e?(_(this.getWidgetFormControls()).each(function(e){e.collapseForm()}),this.$sectionContent.find(".first-widget .move-widget").focus(),this.$sectionContent.find(".add-new-widget").prop("tabIndex",-1)):this.$sectionContent.find(".add-new-widget").prop("tabIndex",0))},getWidgetFormControls:function(){var e;return e=_(this.setting()).map(function(e){var t=n(e),i=d.control(t);if(i)return i})},addWidget:function(e){var n,s,o,a,r,c,l,g,h,u=this,f="widget_form",p=i(e),m=p.number,w=p.id_base,v=d.Widgets.availableWidgets.findWhere({id_base:w});return v?m&&!v.get("is_multi")?!1:(v.get("is_multi")&&!m&&(v.set("multi_number",v.get("multi_number")+1),m=v.get("multi_number")),n=t.trim(t("#widget-tpl-"+v.get("id")).html()),v.get("is_multi")?n=n.replace(/<[^<>]+>/g,function(e){return e.replace(/__i__|%i%/g,m)}):v.set("is_disabled",!0),s=t(n),o=t("<li/>").addClass("customize-control").addClass("customize-control-"+f).append(s),o.find("> .widget-icon").remove(),v.get("is_multi")&&(o.find('input[name="widget_number"]').val(m),o.find('input[name="multi_number"]').val(m)),e=o.find('[name="widget-id"]').val(),o.hide(),r="widget_"+v.get("id_base"),v.get("is_multi")&&(r+="["+m+"]"),o.attr("id","customize-control-"+r.replace(/\]/g,"").replace(/\[/g,"-")),this.container.after(o),c=d.has(r),c||(h={transport:"refresh",previewer:this.setting.previewer},d.create(r,r,{},h)),a=d.controlConstructor[f],l=new a(r,{params:{settings:{"default":r},sidebar_id:u.params.sidebar_id,widget_id:e,widget_id_base:v.get("id_base"),type:f,is_new:!c,width:v.get("width"),height:v.get("height"),is_wide:v.get("is_wide")},previewer:u.setting.previewer}),d.control.add(r,l),d.each(function(t){if(t.id!==u.setting.id&&0===t.id.indexOf("sidebars_widgets[")){var i=t().slice(),n=_.indexOf(i,e);-1!==n&&(i.splice(n),t(i))}}),g=this.setting().slice(),-1===_.indexOf(g,e)&&(g.push(e),this.setting(g)),o.slideDown(function(){c?(l.expandForm(),l.updateWidget({instance:l.setting(),complete:function(e){if(e)throw e;l.focus()}})):l.focus()}),t(document).trigger("widget-added",[s]),l):!1}}),t.extend(d.controlConstructor,{widget_form:d.Widgets.WidgetControl,sidebar_widgets:d.Widgets.SidebarControl}),d.bind("ready",function(){d.Widgets.availableWidgetsPanel=new d.Widgets.AvailableWidgetsPanelView({collection:d.Widgets.availableWidgets}),d.previewer.bind("highlight-widget-control",d.Widgets.highlightWidgetFormControl),d.previewer.bind("focus-widget-control",d.Widgets.focusWidgetFormControl)}),d.Widgets.highlightWidgetFormControl=function(e){var t=d.Widgets.getWidgetFormControlForWidget(e);t&&t.highlightSectionAndControl()},d.Widgets.focusWidgetFormControl=function(e){var t=d.Widgets.getWidgetFormControlForWidget(e);t&&t.focus()},d.Widgets.getSidebarWidgetControlContainingWidget=function(e){var t=null;return d.control.each(function(i){"sidebar_widgets"===i.params.type&&-1!==_.indexOf(i.setting(),e)&&(t=i)}),t},d.Widgets.getWidgetFormControlForWidget=function(e){var t=null;return d.control.each(function(i){"widget_form"===i.params.type&&i.params.widget_id===e&&(t=i)}),t}}}(window.wp,jQuery);